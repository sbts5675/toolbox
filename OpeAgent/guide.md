# OpeAgent
## 機能
コマンドライン実行のRPAツールです。  
スクリプトを引数で指定して実行させます。  
### 実行方法
OpeAgent.exe [スクリプトファイル]  
例. OpeAgent.exe script.txt  

### 仕様
#### 逐次実行関数型
OpeAgentは引数で指定されたスクリプトの各行を、戦闘から順番に解釈、処理していきます。  
各行には1つ(空行、コメント行の場合は0)の関数(入れ子は可能)が記述可能です。
  
例.
> savePos("カーソル座標",getCursorPos()) // カーソル座標を取得して、"カーソル座標"という名前で保存する。
> clickLeft(100,200) // 座標(100,200)で左クリックする
> wait(3) // 3秒待機する
> move(load("カーソル座標")) // "カーソル座標"として保存していた座標を呼び出し、その座標にカーソルを移動させる

#### 座標系
原則としてメインディスプレイのみを対象としています。
(マルチディスプレイ環境で動かない、というわけではなく、サブディスプレイを操作対象として想定していない、ということです)  
画像比較で対象として取得するスクリーンショットはメインディスプレイのみです。
カーソル操作はメイン/サブの区分がないため、サブディスプレイを操作することも可能ですが、マイナス座標は指定できません。

#### データ型
OpeAgentでは文字列型、整数型、真偽値型の3つのデータ型を持ちます。  
すべてのデータ型は文字列型であり、その中で数値として解釈できるものが数値型、真偽値として解釈できるものが真偽値型です。  
そのため、正確には、文字列型、文字列型かつ整数型、文字列型かつ真偽値型、となります。
文字列型を引数として取る関数には数値型、真偽値型を渡すことも可能ですが、  
数値型に数値として解釈できない文字列型や真偽値型を渡すとエラーになります。  
真偽値型についても同様です。  


|データ型|解説|具体例|
|---|---|---|
|文字列型|すべてのデータ型は文字列型に読み替えることが可能です。<br>数値型、真偽値型も文字列型を引数とする関数に渡すことができます。<br>ダブルクォーテーションで囲むことで強制的に文字列型にすることができます。(解釈時に両端のダブルクォーテーションは除去されます)|abc<br>"1,2,3"<br>123<br>true|
|整数型|整数型として解釈できるものです。<br>-2147483648 ～ 2147483647の値をとります。(C#におけるint型)|123<br>-10|
|真偽値型|真偽値として解釈できるものです。<br>True、Falseのみです。|True<br>False

#### 関数解釈
OpeAgentでは独自の関数解釈を行っています。  
関数は文字列として返り値を返し、関数の入れ子において、親関数は子関数の返り値を受けて再度解釈されます。

例.
> savePos("カーソル座標",getCursorPos())
savePosはsavePos(文字列,整数,整数)と、3つの引数を受け取りますが、上記例では2つしかありませんが、エラーにはなりません。  
savePosの引数のチェックは、子関数をすべて解釈した後で実施されます。  
この例の場合、まず子関数のgetCursorPos()が解釈され、返り値としてカーソルの座標(ここでは仮に「10,20」とする)が返されます。
getCursorPos()をこの値で置き換え、以下の形になってからsavePosの解釈が行われます。
> savePos("カーソル座標",10,20)
このような解釈を行うため、スクリプト時点では引数が指定と異なっていることがあります。  
これは、OpeAgentがオブジェクトの概念を持たないためです。
  
#### 関数一覧
OpeAgetは以下の関数を持ちます。

基本
|処理|概要|関数名|返り値|実行例|返り値例|備考|
|---|---|---|---|---|---|---|
|待機|wait(整数)|指定秒待機します。|なし|wait(1)|なし|マイナスの値を指定した場合、エラーを返します。|
|左クリック|clickLeft(数値,数値)|指定座標で左クリックします。|なし|clickLeft(10,20)|なし|マイナスの値を指定した場合、エラーを返します。<br>ただし、-1,-1の場合のみ、ワーニングで処理継続します。|
|右クリック|clickRight(数値,数値)|指定座標で右クリックします。|なし|clickRight(10,20)|なし|マイナスの値を指定した場合、エラーを返します。<br>ただし、-1,-1の場合のみ、ワーニングで処理継続します。|
|カーソル移動|move(数値,数値)|カーソルの位置を指定座標に変更します。|なし|move(10,20)|なし|マイナスの値を指定した場合、エラーを返します。<br>ただし、-1,-1の場合のみ、ワーニングで処理継続します。|
|カーソル移動(可視化)|walk(数値,数値)|カーソルの位置を指定座標に変更します。<br>現在座標から指定座標まで計1秒かけて少しずつ移動します。|なし|walk(10,20)|なし|マイナスの値を指定した場合、エラーを返します。<br>ただし、-1,-1の場合のみ、ワーニングで処理継続します。|
|キー入力|type(文字列)|指定した文字列を入力します。<br>日本語も入力可能です。<br>Enter、Tabや「Shiftを押しながら」等の入力も可能です。|なし|type("Hello")<br>type("%{F4}")|なし|詳細は以下を参照してください。<br>[SendKeys ステートメント](https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/sendkeys-statement)|
|ウィンドウ最前面|setWindowToForeground(文字列)|指定したタイトルを持つウィンドウを最前面に表示します。|True:成功<br>False:失敗|setWindowToForeground("script.txt")|True|Edge等タブブラウザの場合、タブのタイトルに表示されている文字列とは異なる場合があります。|
|変数保存|save(文字列,文字列)|指定した変数名で文字列を保存します。|なし|save("ユーザ名","YAMADA")|なし|「_」で始まる変数名(システム変数用)を指定するとエラーを返します。<br>ダブルクォーテーションの有無を保持します。(「"a"」で保存した場合、loadの結果は「"a"」、「a」で保存した場合、loadの結果は「a」)|
|変数保存(座標用)|savePos(文字列,整数,整数)|指定した変数名で座標(2つの数値)を保存します。|なし|savePos("ボタン座標",10,200)<br>変数「ボタン座標」として「10,200」を保存|なし|getCursorPos等、get○○Pos系と連携する際に便利です。<br>読み込む際はloadを使ってください。|
|変数読込|load(文字列)|指定した変数名で文字列を読込みます。|変数の値|load("ユーザ名")<br>load("ボタン座標")|"YAMADA"<br>10,200|<br>システム変数については別章「システム変数」を参照して下さい。|

制御
|処理|概要|関数名|返り値|実行例|返り値例|備考|
|---|---|---|---|---|---|---|
|IF文|if(真偽値)|引数がTrueの場合、以降、ifEnd()までの処理を実施、Falseの場合実施しない。|なし|if(findImage("ボタン画像.PNG"))|なし<br>システム変数については別章「システム変数」を参照して下さい。|
|IF文(終了)|ifEnd()|IF文の終了箇所を示します。|なし|ifEnd()|なし||

